import json
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from pathlib import Path

from dividefold.utils import struct_to_pairs

to_test = 38432  # 1, 38432, 43094
from_base = "crw" if to_test != 43094 else "rfam"

with open(
    Path(
        f"C:/Users/loico/Downloads/fold_alphafold_test_{from_base}_{to_test}/fold_alphafold_test_{from_base}_{to_test}_full_data_0.json"
    ),
    "r",
) as f:
    d = json.load(f)

probs = np.array(d["contact_probs"])
pae = np.array(d["pae"])

struct_1 = ".(((.(((..((..((((.(((((.((....))))))))..)))).)......(((......((((((((..((...(((((((.((((....(((((((....))))))).....)))).....((((((((((....)))))))))).....((....)).)))))))..))))))))))(((..(.(((..((((((((.......))))))))))).....))))..((((((((....))))...))))))).((((((..........)))))).((((....))))...)))))).......(.(((...(((.(....)))).))))............((((......((((....)))).....)))).[.(((((((...(..((....))..)....))))))..])..((((([[[...(((((.....((.]]])).......)))))))))).....................((([[...(.((((.(.(((.(((((((.(((((((((((....(((((((.....)))))))..)))))))))..)))))))))...(((((((((..(((((((((..((((((((...(((......)))......))))))))..))....(..((....)))))))))).)))))).)))...))))..))))....((((((...((...((((.........))))...))))))))..........((((((..((((((((((((.......))))))))))))...((..]])).....)))))))))).(((......((((....))))....)))........(((((.(((((((.((..(((((((((((((((((....((((........))))........(((((((.....((((((.((..((((((....))).)))..((....)).)))))))).((.((((..(((((((((...(((((((((....)))..((((......))))..)))))).....((((.(((((((...((..(((......)))))....)))))))..((((((((.....)))))))).....))))....)))).)))...))))))))....)))))))...)).))))))))))...(((((((...(((((..((...(((....)))...))....)))))...)))))))......(...((((((((........))))))))...).....))))).....((((((((........))))))))......))...)))))))))).))..(.((.((.(.((((((((..((((((((((((....((((((.((((..((.......))))))))))))...))))))))).)))..))))))))..).))..))..)...."
struct_38432 = (
    "(((((((..((((.........))))((((((.......))))))....(((((.......))))))))))))."
)
struct_43094 = ".......................((((((.....((....))......))))).).........((....))...(((((.....((.....))....)))))..((((...((((((((((((((((.......))))).))))..))))))).....(((((.((((...........(((((((((..(((...(.((.((......))))).........(...)..((.......)).....)))).))))))).....)))))))).))........(((((((........))))))).....(((((........)))))..)))).................................((....))...............((((....))))...................................((((((((((((....(..(((((((.......................................................))))))))...(((((((.....................................................................................................................................................................................................................................)))))))......)).)).))))))))..((((........))))((((((....(((((((((((((..(((..((((((.........))))))..)))...((....))...............(((((..(((..................)))...))))).((((((((...((...........................))...)))))).))....)))))))))))))..((.(...((((((...((((((((((((.((((...(((((((....)))))))....))))...((((.((.((........))))))))..).))))))))))).(((.....)))......))))))......).))..((((((....(((((....)))))..(((((((....................(.((((((....(((....((((((((((..((((((.(.....).))))))))))))))))..)).)....))))))).(((((((((................................................................)))))))))............))))))).....(((.(((((((.....))))))))))....(((......)))...(((((.(...(((......(.(...(((...................(((.((((((((((.......(((((.(((..(((.........)))..)))(...)(...((......)).).)))))...)))))))))))))...................)))..)))))...).)))))(((((((((.........................................)))))))))....))))))(.((((((((.((......((....(((....)))...))...))))))))))..).....))))))..............((((((.......))))))((((.....((((..((...((((((...((.....)).))))))......(((.((...(((((.(((....))))))......(((..............................................................))).....))....))...(((((........)))))..((((..((((...((((.....................................................))))......((((((...((((.(((((((.(.(((((((.........))))))...(((((......(((((((((((((.....)))))))))))))......)))))......(((((((......)))))))..))...))))))).)))).........))))))...........))...)))).))...)))..))....((......)).)))).((((.....))))..))))..((((....((((((((.(((..............(((((...((....))....)))))((((((((((((((.((((((((((((...((((.....((((((((((((((((((.(((((((((((.)))))))))))))..))))))))))))).))))....)))).)))..............)))))))))......)))))..)))))))).(...)......(((((((((..(((.........)))..((((((((.(.((((....)))).)...))))))))..((((.(((..((((((.(..(((....(((((....)))))....))))))))..)))))((((((.......))))))(...)...............((((((.....))))))..........))))...)).)))))))....))).)))))))).))))............(((((........)))))..((((((((.(((.((......((((.(((((((.((((...(((((((..((((((((((((((((((.........(((((..((.......................))............))))))))))))).))))))))))...(((((.....((((..(((((...............)))))................(((((..........................................................................................................................................................................................................)))))..))))..))))).....)))))))....))))..((((.....))).)((((((...........))))))..((....((((((((.((((((.......))))))...))((......))....))))))....(((((((((.......))))))))).(((....))).))..........((((((..((((.......)))))))))).........)))))..))))))........(((.((((((((...((.......))...)))))))..))))..........(((((((((((..((.((((((......))))))...)).(((((.....)))))....)))))..)..)))).).....(((((((....))).))))....))..)))))))))))..................((((((((..((((.((((((((...............))))))))(((((...(((...(((((((((((....))))))..)))))...))).))))).(((....(((((...........)))))....))).))))..)))))))).....(((((((...................................................................................................................................................................)))))))...((((((((((.......)))))...(((((((((.((..(..((((.((((((((....)))))))))))))...))..))).))))))...))))).."


def plot_heatmap_from_struct(struct):
    mat = np.zeros((len(struct), len(struct)))
    pairs = struct_to_pairs(struct)
    for i, j in enumerate(pairs):
        if j > 0:
            mat[i, j - 1] = 1.0
            mat[j - 1, i] = 1.0
    plt.figure()
    sns.heatmap(mat)
    plt.title("True contact map")


plt.figure()
sns.heatmap(probs)
plt.title("AlphaFold contact probabilities")
plot_heatmap_from_struct(locals()[f"struct_{to_test}"])
plt.show()
